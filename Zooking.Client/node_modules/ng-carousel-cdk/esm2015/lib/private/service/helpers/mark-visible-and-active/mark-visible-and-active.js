import { CarouselAlignMode } from '../../../../carousel-align-mode';
import { CarouselSlide } from '../../../models/carousel-slide';
import { MarkVisibleAndActiveResult } from './models/mark-visible-and-active-result';
/**
 * Returns cloned slides with modified `inViewport` and `isActive` fields
 */
export function markVisibleAndActive(slides, offset, slideWidth, viewportWidth, activeSlideIndex, threshold, alignMode) {
    if (!slides || !slides.length) {
        return new MarkVisibleAndActiveResult([], 0, 0);
    }
    const newSlides = [];
    /** Slide index representing first slide inside viewport */
    let inViewportStart = null;
    /** Slide index representing last slide inside viewport */
    let inViewportEnd = null;
    for (let i = 0, currentOffset = offset; i < slides.length; i++, currentOffset += slideWidth) {
        // Calculate slide options
        const slideBeforeViewportEnd = currentOffset < viewportWidth + threshold;
        const slideAfterViewportStart = currentOffset + slideWidth + threshold > 0;
        const inViewport = slideBeforeViewportEnd && slideAfterViewportStart;
        const options = {
            inViewport,
            isActive: i === activeSlideIndex,
        };
        // Construct new slide
        const newSlide = new CarouselSlide(slides[i].id, slides[i].itemIndex, Object.assign({}, slides[i].options, options));
        newSlides.push(newSlide);
        // Detect viewport range
        if (inViewport && inViewportStart === null) {
            inViewportStart = i;
        }
        else if (!inViewport && inViewportStart !== null && inViewportEnd === null) {
            inViewportEnd = Math.max(0, i - 1);
        }
    }
    // Edge case when last slide was in viewport:
    // in such case viewport end index won't be assigned
    // inside slide cycle due to loop algorithm specifics
    if (inViewportStart !== null && inViewportEnd === null) {
        inViewportEnd = slides.length - 1;
    }
    if (activeSlideIndex >= 0 && activeSlideIndex <= slides.length - 1) { // Active slide might be outside slide range
        if (activeSlideIndex <= inViewportStart || inViewportStart === null) {
            const distanceToActiveSlideViewportStart = alignMode === CarouselAlignMode.LEFT
                ? threshold
                : viewportWidth / 2 - slideWidth / 2 + threshold;
            const slidesToViewportStart = Math.ceil(distanceToActiveSlideViewportStart / slideWidth);
            inViewportStart = Math.max(0, activeSlideIndex - slidesToViewportStart);
        }
        if (activeSlideIndex >= inViewportEnd || inViewportEnd === null) {
            const distanceToActiveSlideViewportEnd = alignMode === CarouselAlignMode.LEFT
                ? viewportWidth + threshold
                : viewportWidth / 2 + slideWidth / 2 + threshold;
            const slidesToViewportEnd = Math.ceil(distanceToActiveSlideViewportEnd / slideWidth);
            inViewportEnd = Math.min(slides.length - 1, activeSlideIndex + slidesToViewportEnd);
        }
    }
    const result = new MarkVisibleAndActiveResult(newSlides, inViewportStart || 0, inViewportEnd || 0);
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFyay12aXNpYmxlLWFuZC1hY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZy1jYXJvdXNlbC9zcmMvbGliL3ByaXZhdGUvc2VydmljZS9oZWxwZXJzL21hcmstdmlzaWJsZS1hbmQtYWN0aXZlL21hcmstdmlzaWJsZS1hbmQtYWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ3BFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUUvRCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUVyRjs7R0FFRztBQUNILE1BQU0sVUFBVSxvQkFBb0IsQ0FDaEMsTUFBdUIsRUFDdkIsTUFBYyxFQUNkLFVBQWtCLEVBQ2xCLGFBQXFCLEVBQ3JCLGdCQUF3QixFQUN4QixTQUFpQixFQUNqQixTQUE0QjtJQUU1QixJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtRQUUzQixPQUFPLElBQUksMEJBQTBCLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUNuRDtJQUVELE1BQU0sU0FBUyxHQUFvQixFQUFFLENBQUM7SUFDdEMsMkRBQTJEO0lBQzNELElBQUksZUFBZSxHQUFXLElBQUksQ0FBQztJQUNuQywwREFBMEQ7SUFDMUQsSUFBSSxhQUFhLEdBQVcsSUFBSSxDQUFDO0lBQ2pDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLGFBQWEsR0FBRyxNQUFNLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsYUFBYSxJQUFJLFVBQVUsRUFBRTtRQUN6RiwwQkFBMEI7UUFDMUIsTUFBTSxzQkFBc0IsR0FBRyxhQUFhLEdBQUcsYUFBYSxHQUFHLFNBQVMs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Li8uLi9jYXJvdXNlbC1hbGlnbi1tb2RlJztcbmltcG9ydCB7IENhcm91c2VsU2xpZGUgfSBmcm9tICcuLi8uLi8uLi9tb2RlbHMvY2Fyb3VzZWwtc2xpZGUnO1xuaW1wb3J0IHsgQ2Fyb3VzZWxTbGlkZVBhcmFtcyB9IGZyb20gJy4uLy4uLy4uL21vZGVscy9jYXJvdXNlbC1zbGlkZS1wYXJhbXMnO1xuaW1wb3J0IHsgTWFya1Zpc2libGVBbmRBY3RpdmVSZXN1bHQgfSBmcm9tICcuL21vZGVscy9tYXJrLXZpc2libGUtYW5kLWFjdGl2ZS1yZXN1bHQnO1xuXG4vKipcbiAqIFJldHVybnMgY2xvbmVkIHNsaWRlcyB3aXRoIG1vZGlmaWVkIGBpblZpZXdwb3J0YCBhbmQgYGlzQWN0aXZlYCBmaWVsZHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1hcmtWaXNpYmxlQW5kQWN0aXZlKFxuICAgIHNsaWRlczogQ2Fyb3VzZWxTbGlkZVtdLFxuICAgIG9mZnNldDogbnVtYmVyLFxuICAgIHNsaWRlV2lkdGg6IG51bWJlcixcbiAgICB2aWV3cG9ydFdpZHRoOiBudW1iZXIsXG4gICAgYWN0aXZlU2xpZGVJbmRleDogbnVtYmVyLFxuICAgIHRocmVzaG9sZDogbnVtYmVyLFxuICAgIGFsaWduTW9kZTogQ2Fyb3VzZWxBbGlnbk1vZGUsXG4pOiBNYXJrVmlzaWJsZUFuZEFjdGl2ZVJlc3VsdCB7XG4gICAgaWYgKCFzbGlkZXMgfHwgIXNsaWRlcy5sZW5ndGgpIHtcblxuICAgICAgICByZXR1cm4gbmV3IE1hcmtWaXNpYmxlQW5kQWN0aXZlUmVzdWx0KFtdLCAwLCAwKTtcbiAgICB9XG5cbiAgICBjb25zdCBuZXdTbGlkZXM6IENhcm91c2VsU2xpZGVbXSA9IFtdO1xuICAgIC8qKiBTbGlkZSBpbmRleCByZXByZXNlbnRpbmcgZmlyc3Qgc2xpZGUgaW5zaWRlIHZpZXdwb3J0ICovXG4gICAgbGV0IGluVmlld3BvcnRTdGFydDogbnVtYmVyID0gbnVsbDtcbiAgICAvKiogU2xpZGUgaW5kZXggcmVwcmVzZW50aW5nIGxhc3Qgc2xpZGUgaW5zaWRlIHZpZXdwb3J0ICovXG4gICAgbGV0IGluVmlld3BvcnRFbmQ6IG51bWJlciA9IG51bGw7XG4gICAgZm9yIChsZXQgaSA9IDAsIGN1cnJlbnRPZmZzZXQgPSBvZmZzZXQ7IGkgPCBzbGlkZXMubGVuZ3RoOyBpKyssIGN1cnJlbnRPZmZzZXQgKz0gc2xpZGVXaWR0aCkge1xuICAgICAgICAvLyBDYWxjdWxhdGUgc2xpZGUgb3B0aW9uc1xuICAgICAgICBjb25zdCBzbGlkZUJlZm9yZVZpZXdwb3J0RW5kID0gY3VycmVudE9mZnNldCA8IHZpZXdwb3J0V2lkdGggKyB0aHJlc2hvbGQ7XG4gICAgICAgIGNvbnN0IHNsaWRlQWZ0ZXJWaWV3cG9ydFN0YXJ0ID0gY3VycmVudE9mZnNldCArIHNsaWRlV2lkdGggKyB0aHJlc2hvbGQgPiAwO1xuICAgICAgICBjb25zdCBpblZpZXdwb3J0ID0gc2xpZGVCZWZvcmVWaWV3cG9ydEVuZCAmJiBzbGlkZUFmdGVyVmlld3BvcnRTdGFydDtcbiAgICAgICAgY29uc3Qgb3B0aW9uczogUGFydGlhbDxDYXJvdXNlbFNsaWRlUGFyYW1zPiA9IHtcbiAgICAgICAgICAgIGluVmlld3BvcnQsXG4gICAgICAgICAgICBpc0FjdGl2ZTogaSA9PT0gYWN0aXZlU2xpZGVJbmRleCxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBDb25zdHJ1Y3QgbmV3IHNsaWRlXG4gICAgICAgIGNvbnN0IG5ld1NsaWRlID0gbmV3IENhcm91c2VsU2xpZGUoXG4gICAgICAgICAgICBzbGlkZXNbaV0uaWQsXG4gICAgICAgICAgICBzbGlkZXNbaV0uaXRlbUluZGV4LFxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih7fSwgc2xpZGVzW2ldLm9wdGlvbnMsIG9wdGlvbnMpLFxuICAgICAgICApO1xuICAgICAgICBuZXdTbGlkZXMucHVzaChuZXdTbGlkZSk7XG5cbiAgICAgICAgLy8gRGV0ZWN0IHZpZXdwb3J0IHJhbmdlXG4gICAgICAgIGlmIChpblZpZXdwb3J0ICYmIGluVmlld3BvcnRTdGFydCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgaW5WaWV3cG9ydFN0YXJ0ID0gaTtcbiAgICAgICAgfSBlbHNlIGlmICghaW5WaWV3cG9ydCAmJiBpblZpZXdwb3J0U3RhcnQgIT09IG51bGwgJiYgaW5WaWV3cG9ydEVuZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgaW5WaWV3cG9ydEVuZCA9IE1hdGgubWF4KDAsIGkgLSAxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIEVkZ2UgY2FzZSB3aGVuIGxhc3Qgc2xpZGUgd2FzIGluIHZpZXdwb3J0OlxuICAgIC8vIGluIHN1Y2ggY2FzZSB2aWV3cG9ydCBlbmQgaW5kZXggd29uJ3QgYmUgYXNzaWduZWRcbiAgICAvLyBpbnNpZGUgc2xpZGUgY3ljbGUgZHVlIHRvIGxvb3AgYWxnb3JpdGhtIHNwZWNpZmljc1xuICAgIGlmIChpblZpZXdwb3J0U3RhcnQgIT09IG51bGwgJiYgaW5WaWV3cG9ydEVuZCA9PT0gbnVsbCkge1xuICAgICAgICBpblZpZXdwb3J0RW5kID0gc2xpZGVzLmxlbmd0aCAtIDE7XG4gICAgfVxuXG4gICAgaWYgKGFjdGl2ZVNsaWRlSW5kZXggPj0gMCAmJiBhY3RpdmVTbGlkZUluZGV4IDw9IHNsaWRlcy5sZW5ndGggLSAxKSB7IC8vIEFjdGl2ZSBzbGlkZSBtaWdodCBiZSBvdXRzaWRlIHNsaWRlIHJhbmdlXG4gICAgICAgIGlmIChhY3RpdmVTbGlkZUluZGV4IDw9IGluVmlld3BvcnRTdGFydCB8fCBpblZpZXdwb3J0U3RhcnQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGRpc3RhbmNlVG9BY3RpdmVTbGlkZVZpZXdwb3J0U3RhcnQgPSBhbGlnbk1vZGUgPT09IENhcm91c2VsQWxpZ25Nb2RlLkxFRlRcbiAgICAgICAgICAgICAgICA/IHRocmVzaG9sZFxuICAgICAgICAgICAgICAgIDogdmlld3BvcnRXaWR0aCAvIDIgLSBzbGlkZVdpZHRoIC8gMiArIHRocmVzaG9sZDtcbiAgICAgICAgICAgIGNvbnN0IHNsaWRlc1RvVmlld3BvcnRTdGFydCA9IE1hdGguY2VpbChkaXN0YW5jZVRvQWN0aXZlU2xpZGVWaWV3cG9ydFN0YXJ0IC8gc2xpZGVXaWR0aCk7XG4gICAgICAgICAgICBpblZpZXdwb3J0U3RhcnQgPSBNYXRoLm1heCgwLCBhY3RpdmVTbGlkZUluZGV4IC0gc2xpZGVzVG9WaWV3cG9ydFN0YXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWN0aXZlU2xpZGVJbmRleCA+PSBpblZpZXdwb3J0RW5kIHx8IGluVmlld3BvcnRFbmQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGRpc3RhbmNlVG9BY3RpdmVTbGlkZVZpZXdwb3J0RW5kID0gYWxpZ25Nb2RlID09PSBDYXJvdXNlbEFsaWduTW9kZS5MRUZUXG4gICAgICAgICAgICAgICAgPyB2aWV3cG9ydFdpZHRoICsgdGhyZXNob2xkXG4gICAgICAgICAgICAgICAgOiB2aWV3cG9ydFdpZHRoIC8gMiArIHNsaWRlV2lkdGggLyAyICsgdGhyZXNob2xkO1xuICAgICAgICAgICAgY29uc3Qgc2xpZGVzVG9WaWV3cG9ydEVuZCA9IE1hdGguY2VpbChkaXN0YW5jZVRvQWN0aXZlU2xpZGVWaWV3cG9ydEVuZCAvIHNsaWRlV2lkdGgpO1xuICAgICAgICAgICAgaW5WaWV3cG9ydEVuZCA9IE1hdGgubWluKHNsaWRlcy5sZW5ndGggLSAxLCBhY3RpdmVTbGlkZUluZGV4ICsgc2xpZGVzVG9WaWV3cG9ydEVuZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBuZXcgTWFya1Zpc2libGVBbmRBY3RpdmVSZXN1bHQobmV3U2xpZGVzLCBpblZpZXdwb3J0U3RhcnQgfHwgMCwgaW5WaWV3cG9ydEVuZCB8fCAwKTtcblxuICAgIHJldHVybiByZXN1bHQ7XG59XG4iXX0=